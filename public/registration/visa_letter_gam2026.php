<?php

require_once __DIR__ . '/../../src/bootstrap.php'; // Use bootstrap

$debug = isset($_GET['debug']) && $_GET['debug'] === 'true';

if ($debug) {
    // Debugging settings
    ini_set('display_errors', 1);
    ini_set('display_startup_errors', 1);
    ini_set("log_errors", 1);
    ini_set("error_log", "/var/www/general-assembly/storage/logs/visa-php-error.log");
    error_reporting(E_ALL);
    header('Content-Type: text/html; charset=utf-8');
} else {
    // Production settings
    ini_set("log_errors", 1);
    ini_set("error_log", "/var/www/general-assembly/storage/logs/visa-php-error.log");
    header('Content-Type: application/json');
}

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;
use Dompdf\Dompdf;
use WFOT\Services\AirtableService;

// Check if the request method is POST
if ($_SERVER['REQUEST_METHOD'] === 'POST' || $debug) {

    if ($debug) {

      $salutation = "Mr";
      $firstname = 'First "Näme"';
      $lastname = "Lastnamé";
      $email = "tech@wfot.org";
      $position = "Delegate";
      $memberorg = "Member Ǒrganisation";
      $mailingstreet = "Address Lïne 1";
      $mailingcity = "City";
      $mailingpostalcode = "Postcode";
      $mailingcountry = "Country";
      $registrationAirtableId = null;
      $updateOnly = false;

    } else {
      // Get the JSON payload from the POST request
      $json = file_get_contents('php://input');

      // Decode the JSON into a PHP associative array
      $formdata = json_decode($json, true);
      
      // Check for JSON decode errors
      if (json_last_error() !== JSON_ERROR_NONE) {
          echo json_encode(['success' => false, 'error' => 'Invalid JSON payload']);
          exit;
      }

      // Now you can access the values from your POST request. For example:
      $salutation = $formdata["title"] ?? '';
      $firstname = $formdata["firstName"] ?? '';
      $lastname = $formdata["lastName"] ?? '';
      $email = $formdata["email"] ?? '';
      $position = $formdata["role"] ?? '';
      $memberorg = $formdata["organisation"] ?? null;
      $mailingstreet = $formdata["address1"] ?? '';
      $mailingcity = $formdata["address2"] ?? '';
      $mailingpostalcode = $formdata["address3"] ?? '';
      $mailingcountry = $formdata["country"] ?? '';
      $registrationAirtableId = $formdata["recordId"] ?? null;
      $updateOnly = $formdata["updateOnly"] ?? false;
      
      // Validate required fields
      $requiredFields = ['firstName', 'lastName', 'email', 'role', 'address1', 'address2', 'address3', 'country'];
      $missingFields = [];
      
      foreach ($requiredFields as $field) {
          if (empty($formdata[$field])) {
              $missingFields[] = $field;
          }
      }
      
      if (!empty($missingFields)) {
          echo json_encode(['success' => false, 'error' => 'Missing required fields: ' . implode(', ', $missingFields)]);
          exit;
      }
    }

    //Format for Observer
    if ($position === "Observer"){
      if ($memberorg){
        $roleString = "Member of ".$memberorg;
      } else {
        $roleString = null;
      }
    } else {
      $roleString = $position.' of '.$memberorg;
    }

    $emailHeader='
    <!DOCTYPE html>
    <html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
      <style type="text/css">
        html{
          font-family: "DejaVu Sans", sans-serif;
          font-size: 9pt;
          line-height: 10pt;
        }
      </style>
    </head>

    <body>
    <p><img src="data:image/png;base64,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
    " width= "209" height="80" /></p>
    <p>&nbsp;</p>
    <p>'.$salutation.' '.$firstname.' '.$lastname.'<br>
    '.$roleString.'<br>
      '.$mailingstreet.', '.$mailingcity.'<br>
      '.$mailingpostalcode.'<br>
      '.$mailingcountry.'</p>
    <p>&nbsp;</p>
    <p>'.date('l\, jS \of F Y').'</p>
    <p>&nbsp;</p>
    ';

    $emailMessageDelegate = '
    <p>Dear '.$salutation.' '.$firstname.' '.$lastname.',</p>
    <p>This letter is to invite you to attend the 37th Meeting of the General Assembly of the World Federation of Occupational Therapists (WFOT) and the 19th WFOT Congress in Bangkok, Thailand.</p>

    <p>The WFOT General Assembly Meeting will be held between 5th and 7th February 2026. The venue for the General Assembly Meeting is at:</p>
    <p><strong>Carlton Hotel Bangkok Sukhumvit</strong><br>
    491 Sukhumvit Road, Klongtoey Nua,<br>
    Wattana, Bangkok 10110, Thailand</p>

    <p>Email: enquiry@carltonhotel.co.th<br>
    Telephone: +66 2 090 7888</p>

    <p>The WFOT Congress will be held between 9th and 12th February 2026. The venue for the Congress is at: </p>
    <p><strong>Bangkok International Trade and Exhibition Centre (BITEC)</strong><br>
    88 Band Na-Trat Road, Bang Na<br>
    Bangkok 10260, Thailand<br>
    https://www.bitec.co.th</p>

    <p>Please note that with the exception of those Delegates that will be / have been awarded the General Assembly Participation Fund, all other Delegates will have to fund their own airfare. All Delegates are required to fund their own accommodation and subsistence.</p>

    <p>Should you require additional documentation, please contact Ritchard Ledgerd, WFOT Executive Director at admin@wfot.org.</p>';

    $emailMessageObserver = '
    <p>Dear '.$salutation.' '.$firstname.' '.$lastname.',</p>
    <p>This letter is to invite you to attend the 37th Meeting of the General Assembly of the World Federation of Occupational Therapists (WFOT) in Bangkok, Thailand.</p>

    <p>The WFOT General Assembly Meeting will be held between 5th and 7th February 2026. The venue for the General Assembly Meeting is at:</p>
    <p><strong>Carlton Hotel Bangkok Sukhumvit</strong><br>
    491 Sukhumvit Road, Klongtoey Nua,<br>
    Wattana, Bangkok 10110, Thailand</p>

    <p>Email: enquiry@carltonhotel.co.th<br>
    Telephone: +66 2 090 7888</p>

    <p>Please note that you will have to fund your own airfare, costs for accommodation and subsistence.</p>

    <p>Should you require additional documentation, please contact Ritchard Ledgerd, WFOT Executive Director at admin@wfot.org.</p>';

    $emailFooter = '
    <p>Yours sincerely,</p>
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <tbody>
        <tr>
          <td><p><img border="0"
      width="149" height="47"
      src="data:image/jpeg;base64,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
    "></p>
            <p>Ritchard Ledgerd<br>
              Executive Director<br>
          World Federation of Occupational Therapists</p></td>
          <td><p><img border="0" width="132" height="47"
      src="data:image/png;base64,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" alt="Duen-ngarm Pakdee Signature"></p>
            <p>Duen-ngarm Pakdee<br>
              President <br>
              Occupational Therapists Association of Thailand</p></td>
        </tr>
      </tbody>
    </table>
    <p>&nbsp;</p>
    </body>
    </html>';

    // Load the HTML content
    if ($position === 'Observer') {
        $html = $emailHeader . $emailMessageObserver . $emailFooter;
    } else {
        $html = $emailHeader . $emailMessageDelegate . $emailFooter;
    }

    $filename = 'Invitation Letter - '.sanitizeFilename($firstname).' '.sanitizeFilename($lastname).' - ' .uniqid(rand()). '.pdf';

    $dompdf = new Dompdf();
    $dompdf->loadHtml($html);

    // Clear output buffer
    if (ob_get_length()) {
        ob_clean();
    }

    // (Optional) Setup the paper size and orientation
    $dompdf->setPaper('A4', 'portrait');
    $dompdf->render();

    // Render the HTML as PDF
    $pdfString = $dompdf->output();

    // If updateOnly is true, skip email sending but continue with Airtable upload
    if ($updateOnly) {
        if (!$registrationAirtableId) {
            echo json_encode(['success' => false, 'error' => 'recordId is required for updateOnly mode']);
            exit;
        }
        
        $response = ['success' => true, 'message' => 'Update only mode - PDF generated but no email sent'];
        
        // Jump to Airtable upload section
        goto airtable_upload;
    }

    $emailTo = $email;
    $emailToName = $firstname.' '.$lastname;

    $mail = new PHPMailer;
    $mail->CharSet = "UTF-8";
    $mail->isSMTP(); 
    $mail->SMTPDebug = 0; // 0 = off (for production use) - 1 = client messages - 2 = client and server messages
    $mail->Host = env('SMTP_HOST'); // use $mail->Host = gethostbyname('smtp.gmail.com'); // if your network does not support SMTP over IPv6
    $mail->Port = 587; // TLS only
    $mail->SMTPSecure = 'tls'; // ssl is depracated
    $mail->SMTPAuth = true;
    $mail->Username = env('SMTP_USERNAME');
    $mail->Password = env('SMTP_PASSWORD');
    $mail->addReplyTo(env('MAIL_BCC_ADMIN'), env('MAIL_FROM_NAME'));
    $mail->setFrom(env('MAIL_FROM'), env('MAIL_FROM_NAME'));
    $mail->addAddress($emailTo, $emailToName);
    $mail->Subject = '37th WFOT Meeting - General Assembly: Your Invitation Letter';
    $mail->msgHTML('
    <p>Dear '.$firstname.' '.$lastname.',</p>
    <p>Thank you for registering to attend the 37th WFOT Meeting - General Assembly in Bangkok. Please find your invitation letter attached. If you have any questions regarding your invitation letter, please contact the WFOT Secretariat at <a href="mailto:admin@wfot.org?subject=General Assembly Meeting 2026 Invitation Letter">admin@wfot.org</a></p>
    <p>Kind regards,<br>
    WFOT Organisational Management Team</p>
    ');
    $mail->AltBody = 'Dear '.$firstname.' '.$lastname.', Thank you for registering to attend the 37th WFOT Meeting - General Assembly in Bangkok. Please find your invitation letter attached. If you have any questions regarding your invitation letter, please contact the WFOT Secretariat at admin@wfot.org. Kind regards, WFOT Organisational Management Team';
    $mail->addStringAttachment($pdfString, $filename);

    if(!$mail->send()){
        echo json_encode(['success' => false, 'error' => $mail->ErrorInfo]);
    }else{
        $response = ['success' => true];
        
        airtable_upload:
        // Upload PDF to Airtable if recordId is provided
        if (!$debug && isset($registrationAirtableId) && !empty($registrationAirtableId)) {
            try {
                $airtableService = new AirtableService();
                $tableId = 'tblxFb5zXR3ZKtaw9';
                $fieldId = 'flduDuIyEEazX7dxp';
                
                $uploadSuccess = $airtableService->uploadAttachment(
                    $tableId,
                    $registrationAirtableId,
                    $fieldId,
                    $filename,
                    $pdfString
                );
                
                if ($uploadSuccess) {
                    $response['airtable_upload'] = 'success';
                } else {
                    $response['airtable_upload'] = 'failed';
                    $response['airtable_error'] = 'Upload failed';
                }
                
            } catch (Exception $e) {
                error_log("Airtable upload exception: " . $e->getMessage());
                $response['airtable_upload'] = 'failed';
                $response['airtable_error'] = $e->getMessage();
            }
        }
        
        echo json_encode($response);
    }

} else {
    // If the request method was not POST, return an error message
    echo json_encode(['success' => false, 'error' => 'This endpoint only accepts POST requests']);
}

function sanitizeFilename($name) {
  // Normalize UTF-8 encoding to avoid decomposed characters
  $name = Normalizer::normalize($name, Normalizer::FORM_C);
  // Replace special characters with underscore
  $name = preg_replace('/[\\/:*?"<>|\r\n]+/', '_', $name);
  return $name;
}
?>